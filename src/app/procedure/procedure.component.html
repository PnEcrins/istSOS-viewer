
<div class="container-fluid" >
  <div class="mt-2">
    <div class="row">
      <div class="col-4">
          <mat-card class="example-card">
              <mat-card-header>
                  <mat-icon mat-card-avatar> explore</mat-icon>
                <!-- <div mat-card-avatar class="example-header-image"></div> -->
                <mat-card-title> {{procedure?.properties.name}} </mat-card-title>
                <mat-card-subtitle> {{procedure?.properties.description}} </mat-card-subtitle>
                <mat-card-subtitle> Sensor type :  {{procedure?.properties.sensortype}} </mat-card-subtitle>
                <mat-card-subtitle> Time serie :  From {{procedure?.properties.samplingTime.beginposition}} to {{procedure?.properties.samplingTime.endposition}} </mat-card-subtitle>
              </mat-card-header>
              <leaflet-map
                [center]="config.map.center"
                [zoom]="config.map.zoom"
                [basemap]="config.map.basemap"
                height="40vh"
                >
            </leaflet-map>
              <mat-card-content>
                  <h3>Observed properties</h3>
                  <div class="prop-flex-container" >
                      <small class="prop" *ngFor="let prop of procedure?.properties.observedproperties"> 
                            - {{prop.name}} <span class="text-muted"> ( {{prop.uom}} )</span> 
                      </small>
                  </div>
              </mat-card-content>
            </mat-card>
      </div>
      <div class="col-8">
          <mat-card *ngIf="!noDataOnProcedure; else elseBlock">
              <mat-card-header>
                  <mat-icon mat-card-avatar> timeline</mat-icon>
                  <mat-card-title> Data </mat-card-title>
              </mat-card-header>
              <mat-card-content >
                  <mat-spinner style="margin:0 auto;" *ngIf="!data"></mat-spinner>

                  <div 
                      [ngStyle]="{'visibility': data ? 'visible': 'hidden', 'height': data ? 'auto': '0px' }" id="plotly"></div>
                  <small> From {{startPosition ?  (startPosition | date:'short'): ''}} to {{endPosition ? (endPosition |date:'short') : 'n/a'}} </small> <br>
                  <div *ngFor="let form of plotForm.get('observedProperties').controls; let i=index">
                      <mat-form-field appearance="fill">
                          <mat-label>Observed properties</mat-label>
                          <mat-select [formControl]="form.get('propertyName')">
                            <mat-option *ngFor="let prop of observedProperties" [value]="prop.def">{{prop.name}}</mat-option>
                          </mat-select>
                        </mat-form-field>
                        <mat-form-field appearance="fill">
                          <mat-label>Plot type</mat-label>
                          <mat-select [formControl]="form.get('plotType')">
                            <mat-option value="lines" > lines </mat-option>
                            <mat-option value="markers">  markers</mat-option>
                          </mat-select>
                        </mat-form-field>
                        <button *ngIf="i>0" (click)="removePropertyForm(i)" matTooltip="Remove this property" mat-mini-fab color="warn">
                          <mat-icon>remove</mat-icon>
                        </button>
                  </div>

                    <button (click)="addNewPropertyForm()" matTooltip="Add a new property" mat-mini-fab color="primary" aria-label="Example icon button with a home icon">
                      <mat-icon>add</mat-icon>
                    </button>
                  
                    <br>
                    <mat-form-field appearance="fill">
                      <mat-label>Start date</mat-label>
                      <input matInput [matDatepicker]="pickerStart" [formControl]="plotForm.get('startDate')">
                      <mat-hint>MM/DD/YYYY</mat-hint>
                      <mat-datepicker-toggle matSuffix [for]="pickerStart"></mat-datepicker-toggle>
                      <mat-datepicker #pickerStart></mat-datepicker>
                    </mat-form-field>
                    <mat-form-field appearance="fill">
                      <mat-label>End  date</mat-label>
                      <input matInput [matDatepicker]="pickerEnd" [formControl]="plotForm.get('endDate')">
                      <mat-hint>MM/DD/YYYY</mat-hint>
                      <mat-datepicker-toggle matSuffix [for]="pickerEnd"></mat-datepicker-toggle>
                      <mat-datepicker #pickerEnd></mat-datepicker>
                    </mat-form-field>
              </mat-card-content>

              <mat-card-actions>
                  <button (click)="onPlotData()" mat-raised-button color="primary">Plot</button>
                  <button mat-raised-button color="secondary">Export</button>
                </mat-card-actions>
              <mat-card-footer>
                  
              </mat-card-footer>
          </mat-card>
          <ng-template #elseBlock>
              <mat-card>
                  <mat-card-content>
                      <h2>No data on this procedure</h2>
                  </mat-card-content>
              </mat-card>
          </ng-template>

      </div>
  </div>
  </div>
 

</div>

